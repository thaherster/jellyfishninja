<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="dashassets/img/apple-icon.png" />
    <link rel="icon" type="image/png" href="dashassets/img/favicon.png" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Jellyfish Ninja | Reports</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />
    <!-- Bootstrap core CSS     -->
    <link href="dashassets/css/bootstrap.min.css" rel="stylesheet" />
    <!--  Material Dashboard CSS    -->
    <link href="dashassets/css/material-dashboard.css?v=1.2.0" rel="stylesheet" />
    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="dashassets/css/demo.css" rel="stylesheet" />
    <!--     Fonts and icons     -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700,300|Material+Icons" rel='stylesheet'>
</head>

<body>
<div class="wrapper">
    <div class="sidebar" data-color="purple" data-image="dashassets/img/sidebar-1.jpg">
        <!--
    Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

    Tip 2: you can also add an image using data-image tag
-->
        <div class="logo">
            <a href="/" class="simple-text">
                Jellyfish Ninja
            </a>
        </div>
        <div class="sidebar-wrapper">
            <ul class="nav">
                <li>
                    <a href="/dashboard">
                        <i class="material-icons">dashboard</i>
                        <p>Dashboard</p>
                    </a>
                <li>
                <li>
                    <a href="/applications">
                        <i class="material-icons">bubble_chart</i>
                        <p>Applications</p>
                    </a>
                </li>
                <li  class="active">
                    <a href="/reports">
                        <i class="material-icons">content_paste</i>
                        <p>Reports</p>
                    </a>
                </li>
                <!--<li>-->
                    <!--<a href="/user">-->
                        <!--<i class="material-icons">person</i>-->
                        <!--<p>Profile</p>-->
                    <!--</a>-->
                <!--</li>-->
                <li>
                    <a href="/device">
                        <i class="material-icons">devices_other</i>
                        <p>Devices</p>
                    </a>
                </li>

                <li class="active-pro">
                    <a href="upgrade">
                        <i class="material-icons">unarchive</i>
                        <p>Upgrade</p>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="main-panel">
        <nav class="navbar navbar-transparent navbar-absolute">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#"> Reports </a>
                    <select  class="navbar projectsselect"  id="selectdropdown">
                        <% projectList.forEach(function(pjct) { %>
                        <option  class="optionclick" value="<%= pjct.childKey %>"><%= pjct.appname %></option>
                        <% }); %>
                    </select>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="/dashboard">
                                <i class="material-icons">dashboard</i>
                                <p class="hidden-lg hidden-md">Dashboard</p>
                            </a>
                        </li>
                        <!--<li class="dropdown">-->
                            <!--<a href="#" class="dropdown-toggle" data-toggle="dropdown">-->
                                <!--<i class="material-icons">notifications</i>-->
                                <!--<span class="notification">5</span>-->
                                <!--<p class="hidden-lg hidden-md">Notifications</p>-->
                            <!--</a>-->
                            <!--<ul class="dropdown-menu">-->
                                <!--<li>-->
                                    <!--<a href="#">Mike John responded to your email</a>-->
                                <!--</li>-->
                                <!--<li>-->
                                    <!--<a href="#">You have 5 new tasks</a>-->
                                <!--</li>-->
                                <!--<li>-->
                                    <!--<a href="#">You're now friend with Andrew</a>-->
                                <!--</li>-->
                                <!--<li>-->
                                    <!--<a href="#">Another Notification</a>-->
                                <!--</li>-->
                                <!--<li>-->
                                    <!--<a href="#">Another One</a>-->
                                <!--</li>-->
                            <!--</ul>-->
                        <!--</li>-->
                        <li>
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="material-icons">person</i>
                                <p class="hidden-lg hidden-md">Profile</p>
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a ><%= useremail %></a>
                                </li>
                                <!--<li>-->
                                    <!--<a href="/user">Profile</a>-->
                                <!--</li>-->
                                <!--<li>-->
                                <!--<a href="#">You have 5 new tasks</a>-->
                                <!--</li>-->
                                <!--<li>-->
                                <!--<a href="#">You're now friend with Andrew</a>-->
                                <!--</li>-->
                                <!--<li>-->
                                <!--<a href="#">Another Notification</a>-->
                                <!--</li>-->
                                <li>
                                    <a href="/logout">Logout</a>
                                </li>
                            </ul>

                        </li>

                    </ul>
                    <!--<form class="navbar-form navbar-right" role="search">-->
                        <!--<div class="form-group  is-empty">-->
                            <!--<input type="text" class="form-control" placeholder="Search">-->
                            <!--<span class="material-input"></span>-->
                        <!--</div>-->
                        <!--<button type="submit" class="btn btn-white btn-round btn-just-icon">-->
                            <!--<i class="material-icons">search</i>-->
                            <!--<div class="ripple-container"></div>-->
                        <!--</button>-->
                    <!--</form>-->
                </div>
            </div>
        </nav>
        <div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card card-nav-tabs">
                            <div class="card-header" data-background-color="purple">
                                <div class="nav-tabs-navigation">
                                    <div class="nav-tabs-wrapper">
                                        <ul class="nav nav-tabs" data-tabs="tabs">
                                            <li class="active">
                                                <a href="#profile" data-toggle="tab">
                                                    <i class="material-icons">bug_report</i> Bugs
                                                    <div class="ripple-container"></div>
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="#messages" data-toggle="tab">
                                                    <i class="material-icons">code</i> API
                                                    <div class="ripple-container"></div>
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="#settings" data-toggle="tab">
                                                    <i class="material-icons">timeline</i> Suggestions
                                                    <div class="ripple-container"></div>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="tab-content">
                                    <div class="tab-pane active" id="profile">
                                        <table class="table">
                                            <tbody id="bugstable">
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="tab-pane" id="messages">
                                        <table class="table" id="apitable">
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="tab-pane" id="settings">
                                        <table class="table" id="suggesttable">
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog">

                <div class="card modal-content">
                    <div class="card-header modal-header" data-background-color="purple">
                        <h4 class="title_report"></h4>
                        <select class="navbar stateselect"   id="selectdropdownstate">
                            <option  class="optionclick"  value="0">Open</option>
                            <option  class="optionclick" value="1">Ready for Testing</option>
                            <option  class="optionclick"  value="2">Closed</option>
                        </select>

                    </div>
                    <div class="card-content modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group label-floating is-focused">
                                <h4><span style='font-weight: bold;'>Description</span></h4>
                                <p class="desc_report"></p>
                                <h4 class="img_report_as"><span style='font-weight: bold;'>Screenshot</span></h4>
                                <img class="img_report" src="">
                            </div>
                            </div>
                        </div>
                    </div>



                </div>


            </div>
        </div>


        <footer class="footer">
            <div class="container-fluid">
                <nav class="pull-left">
                    <ul>

                    </ul>
                </nav>
                <p class="copyright pull-right">
                    &copy;
                    <script>
                        document.write(new Date().getFullYear())
                    </script>
                    <a href="#">Jellyfish Ninja</a>, made with love for a better code
                </p>
            </div>
        </footer>
    </div>
</div>
</body>
<!--   Core JS Files   -->
<script src="dashassets/js/jquery-3.2.1.min.js" type="text/javascript"></script>
<script src="dashassets/js/bootstrap.min.js" type="text/javascript"></script>
<script src="dashassets/js/material.min.js" type="text/javascript"></script>
<!--  Charts Plugin -->
<script src="dashassets/js/chartist.min.js"></script>
<!--  Dynamic Elements plugin -->
<script src="dashassets/js/arrive.min.js"></script>
<!--  PerfectScrollbar Library -->
<script src="dashassets/js/perfect-scrollbar.jquery.min.js"></script>
<!--  Notifications Plugin    -->
<script src="dashassets/js/bootstrap-notify.js"></script>
<!--  Google Maps Plugin    -->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
<!-- Material Dashboard javascript methods -->
<script src="dashassets/js/material-dashboard.js?v=1.2.0"></script>
<!-- Material Dashboard DEMO methods, don't include it in your project! -->
<script src="dashassets/js/demo.js"></script>
<script>
    var current_item;
    var current_project;

    window.onload = function () {
        var state = <%- JSON.stringify(projectList) %>

            console.log(state[0].childKey)
        if(state.length>0)
        { fetchData(state[0].childKey);}
    }

    var bugsList;
    var apiList;
    var suggestionList;

    function poplayedata(data) {
        console.log("SUCCESS : ", data.bugsList +" SIZE "+data.bugsList.length);
        console.log("SUCCESS : ", data.apiList +" SIZE "+data.apiList.length);
        console.log("SUCCESS : ", data.suggestionList +" SIZE "+data.suggestionList.length);
        bugsList =data.bugsList;
        apiList =data.apiList;
        suggestionList =data.suggestionList;
        $("#bugstable tr").remove();
        $("#apitable tr").remove();
        $("#suggesttable tr").remove();

        for (var i = 0; i < data.bugsList.length; i++)
        {
            var key = data.bugsList[i].key;
            var status  = data.bugsList[i].status;
            var text = data.bugsList[i].text;
            var title = data.bugsList[i].title;
            var type = data.bugsList[i].type;


            $('#bugstable').append(
                '<tr  data-id='+i+'>'+
                '<td>'+
                '<div class="checkbox">'+
                '<label>'+ (data.bugsList[i].status === "2" ?'<p>Closed</p>':'<input type="checkbox" onclick="javascript: return false;" name="optionsCheckboxes"'+(data.bugsList[i].status === "1" ?'checked': '')+'>' )+
                '</label>'+
                '</div>'+
                '</td>'+
                '<td>'+data.bugsList[i].title+'</td>'+
                '<td class="td-actions text-right">'+
                '<button data-id='+i+' type="button" rel="tooltip" title="Open" class="btn btn-primary btn-simple btn-xs switch-zero">'+
                '<i class="material-icons">streetview</i>'+
                '</button>'+
                '</td>'+
                '</tr>'
            );

        }
        for (var i = 0; i < data.apiList.length; i++)
        {
            $('#apitable').append(
                '<tr  data-id='+i+'>'+
                '<td>'+
                '<div class="checkbox">'+
                '<label>'+ (data.apiList[i].status === "2" ?'<p>Closed</p>':'<input type="checkbox" onclick="javascript: return false;" name="optionsCheckboxes"'+(data.apiList[i].status === "1" ?'checked': '')+'>' )+
                '</label>'+
                '</div>'+
                '</td>'+
                '<td>'+data.apiList[i].title+'</td>'+
                '<td class="td-actions text-right">'+
                '<button  data-id='+i+'  type="button" rel="tooltip" title="Open" class="btn btn-primary btn-simple btn-xs switch-one">'+
                '<i class="material-icons">streetview</i>'+
                '</button>'+
                '</td>'+
                '</tr>'
            );

        }

        for (var i = 0; i < data.suggestionList.length; i++)
        {
            $('#suggesttable').append(
                '<tr  data-id='+i+'>'+
                '<td>'+
                '<div class="checkbox">'+
                '<label>'+ (data.suggestionList[i].status === "2" ?'<p>Closed</p>':'<input type="checkbox" onclick="javascript: return false;" name="optionsCheckboxes"'+(data.suggestionList[i].status === "1" ?'checked': '')+'>' )+
                '</label>'+
                '</div>'+
                '</td>'+
                '<td>'+data.suggestionList[i].title+'</td>'+
                '<td class="td-actions text-right">'+
                '<button  data-id='+i+' type="button" rel="tooltip" title="Open" class="btn btn-primary btn-simple btn-xs switch-two">'+
                '<i class="material-icons">streetview</i>'+
                '</button>'+
                '</td>'+
                '</tr>'
            );

        }


//               if( data.reportsList.length<=0)
//               {
//
//               }
        // return data;
    }

    function fetchData(valueSelected) {
        current_project = valueSelected;

        $.ajax({
            type: "GET",
            url: "/reports_data",
           contentType: "application/json",
            data:{ valueSelected: valueSelected },
            cache: false,
            timeout: 600000,
           success: function (data) {
              poplayedata(data);
           },
            error: function (e) {

                console.log("ERROR : ", e);

            }
        });

    }

    $('.projectsselect').on('change', function (e) {
        var optionSelected = $("option:selected", this);
        var valueSelected = this.value;
        fetchData(valueSelected);

    });


    function changeReport(current_item, valueSelected,current_project) {
        $.ajax({
            type: "GET",
            url: "/set_reports_data",
            contentType: "application/json",
            data:{ current_item: current_item,
            status :valueSelected,
            current_project:current_project},
            cache: false,
            timeout: 600000,
            success: function (data) {
                poplayedata(data);
            },
            error: function (e) {

                console.log("ERROR : ", e);

            }
        });

    }

    $('.stateselect').on('change', function (e) {
        var valueSelected = this.value;
        changeReport(current_item,valueSelected,current_project );

    });


    function popitUp(popitemitem) {
        current_item = popitemitem;
        $('.title_report').text(current_item.title);
        $('.desc_report').text(current_item.text);
        var idas =current_item.status;
        console.log(" SELECT "+idas);
        $('#selectdropdownstate').val(idas).change();
        if(!current_item.imgurl)
        {
            $('.img_report').hide();
            $('.img_report_as').hide();

        }
        else {
            $('.img_report').show();
            $('.img_report_as').show();
            $('.img_report').attr("src",current_item.imgurl);

        }


        $('#myModal').modal({show:true});
    }

    $(document).on('click','.switch-two',function () {
        var id = $(this).data('id');
        popitUp(suggestionList[id]);

    });
    $(document).on('click','.switch-one',function () {
        var id = $(this).data('id');
        popitUp(apiList[id]);

    });
    $(document).on('click','.switch-zero',function () {
        var id = $(this).data('id');
        popitUp(bugsList[id]);

    });



</script>
</html>